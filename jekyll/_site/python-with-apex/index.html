<!DOCTYPE html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--><!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--><!--[if gt IE 8]><!--><html class="no-js">
<!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <title>Up to Speed with Apex – Ryan Wise</title> <meta name="description" content="Full time software engineer, with freelance on the side. I do a lot of side projects involving electronics and technologies I find interesting. In addition I have a passion for cars, motorcycles and motorsport, I enjoy working on them and competing in events."> <meta name="keywords" content="AWS, Python, Node.js, Lambda, Apex"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="/assets/img/logo.png"> <meta name="twitter:title" content="Up to Speed with Apex"> <meta name="twitter:description" content="Setting up an AWS Serverless API with Apex [Node.js, Python and more!]"> <meta name="twitter:site" content="@leobeosab"> <meta name="twitter:creator" content="@leobeosab"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Up to Speed with Apex"> <meta property="og:description" content="Setting up an AWS Serverless API with Apex [Node.js, Python and more!]"> <meta property="og:url" content="/python-with-apex/"> <meta property="og:site_name" content="Ryan Wise"> <meta property="og:image" content="/assets/img/logo.png"> <link rel="canonical" href="/python-with-apex/"> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Ryan Wise Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- JS --> <script src="/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="/favicon.png"> <link rel="shortcut icon" href="/favicon.ico"> <!-- Background Image --> <style type="text/css">body {background-image:url(/assets/img/placeholder-big.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> <!-- Global site tag (gtag.js) - Google Analytics --> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140286077-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-140286077-1'); </script> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="/">Home</a></li> <li><a href="/about/">About</a></li> <li><a href="/projects/">Projects</a></li> <li><a href="/posts/">Posts</a></li> </ul> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Up to Speed with Apex</h1> <h4>13 May 2019</h4> <p class="reading-time"> <i class="fa fa-clock-o"></i> Reading time ~5 minutes </p>
<!-- /.entry-reading-time --> <a class="btn zoombtn" href="/posts/"> <i class="fa fa-chevron-left"></i> </a> </div> <h1 id="intro">Intro</h1> <p>Using this amazing tool I found called <a href="https://apex.run">Apex</a> we will get a basic Python, Node.js, Ruby, etc AWS Lambda API running in minutes! I’ll be using Python for this guide but it only takes 1 line of code to change the runtime you want :)</p> <p>If you want to see a real world application of this kind of API see one of my projects <a href="/lambda-s3-updater">here</a></p> <h2 id="step-one-installing--setting-up-aws-cli--apex">Step One: Installing &amp; Setting up AWS CLI + Apex</h2> <p>The easiest way to setup Apex is to use the AWS CLI, though this is completely up to you. Apex also allows configuration via Environment Variables, IAM roles and more.</p> <p>So let’s install AWS CLI</p> <p>MacOS (My OS at the time of writing) <code class="highlighter-rouge">brew install awscli</code> <br> Debian Linux <code class="highlighter-rouge">sudo apt-get install awscli</code></p> <p>Run the command <code class="highlighter-rouge">aws configure</code> and fill out your credentials, if you don’t understand what it’s asking for go to the IAM Management Console on your AWS Dashboard and follow the steps for adding a user.</p> <p>Onto the Apex installation, fortunately Apex gives us an easy one liner for this <br> <code class="highlighter-rouge">curl https://raw.githubusercontent.com/apex/apex/master/install.sh | sh</code> <br> Windows <a href="https://github.com/apex/apex/releases">Binary</a></p> <h2 id="step-two-slapping-together-an-api-the-easy-and-right-way">Step Two: Slapping together an API (the easy and right way)</h2> <h3 id="intro-to-apex">Intro to Apex</h3> <p>We could do <code class="highlighter-rouge">apex init</code> for this step but I think going through it yourself is better plus I need another step in this guide.</p> <p>There are two important pieces to your Apex setup one being a project.json file, the other being the structure of a functions directory. The project.json file sets project wide settings as well as setting default values for all functions. Create a functions.json file with the following values</p> <h3 id="projectjson---setting-generic-parameters-for-project--functions-available-parameters">project.json - Setting generic parameters for project / functions. <a href="#parameters-for-project--function">available parameters</a>
</h3> <div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"My AWS API"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Collection of lmabda functions to accomplish tasks of a sort"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"memory"</span><span class="p">:</span><span class="w"> </span><span class="mi">128</span><span class="p">,</span><span class="w">
  </span><span class="nt">"timeout"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
  </span><span class="nt">"role"</span><span class="p">:</span><span class="w"> </span><span class="s2">"arn:aws:iam::910144801136:role/AWSAPITools_lambda_function"</span><span class="w"> </span><span class="err">//</span><span class="w"> </span><span class="err">Note</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">just</span><span class="w"> </span><span class="err">my</span><span class="w"> </span><span class="err">role</span><span class="p">,</span><span class="w"> </span><span class="err">yours</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">create</span><span class="w"> </span><span class="err">will</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">different</span><span class="w">
</span><span class="err">}</span><span class="w">
</span></code></pre></div> <p>Now onto the actual functions directory which will (obviously) hold our functions’ code. The directory will be made up of folders with the name of whatever function you want it to hold. Each folder will contain be an index file, necessary dependencies, and an optional function.json file.</p> <h3 id="project-structure">Project Structure</h3> <div class="highlighter-rouge"><pre class="highlight"><code> | 
 | - project.json
 | - functions/
 |   |
 |   | - ExampleFunctionWithOverrides
 |   |   |
 |   |   | - function.json (json object with updated parameters)
 |   |   | - main.py (index.js for Node.js, view Apex's documentation for other runtimes) 
 |   | - ExampleFunctionNoOverrides
 |   |   |
 |   |   | - main.py 
</code></pre></div> <h3 id="mainpy">main.py</h3> <div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">json</span>

<span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>

    <span class="n">body</span> <span class="o">=</span> <span class="s">"Yoo, what's good Lambda?"</span>
    <span class="n">statusCode</span> <span class="o">=</span> <span class="mi">200</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s">'statusCode'</span><span class="p">:</span> <span class="n">statusCode</span><span class="p">,</span>
        <span class="s">'body'</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div> <h3 id="running">Running</h3> <p>And boom! We now have a working lambda function and to see it in action running on AWS we only need 2 commands.</p> <div class="highlighter-rouge"><pre class="highlight"><code>apex deploy
apex invoke ExampleFunction 
</code></pre></div> <p>Now you should see in your console:</p> <div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="nt">"statusCode"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> </span><span class="nt">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"\"Yoo, what's good Lambda?\""</span><span class="p">}</span><span class="w">
</span></code></pre></div> <h3 id="parameters-for-project--function">Parameters for Project / Function</h3> <table> <thead> <tr> <th>Paramater Name</th> <th>Description</th> <th>Function Param</th> </tr> </thead> <tbody> <tr> <td>Name</td> <td>Sets the name for the Apex project</td> <td>❌</td> </tr> <tr> <td>Description</td> <td>Sets the description for the Apex project</td> <td>❌</td> </tr> <tr> <td>Memory</td> <td>Value of the amount of memory you want available to the lambda</td> <td>✅</td> </tr> <tr> <td>Timeout</td> <td>How many seconds should AWS wait for this to complete?</td> <td>✅</td> </tr> <tr> <td>Role</td> <td>What AWS IAM role does this have access too (IAM role is how AWS manages permissions)</td> <td>✅</td> </tr> <tr> <td>Runtime</td> <td>What language and version is this code? Ex: [‘Node.js’, ‘Python3.7’, ‘Ruby’]</td> <td>✅</td> </tr> </tbody> </table> <style type="text/css"> /* Fixing this one off table */ #parameters-for-project--function + table thead tr { border-bottom: 2px solid #666; } #parameters-for-project--function + table tbody tr:not(:last-of-type) { border-bottom: 2px solid #666; } #parameters-for-project--function + table tr * { padding: 5px; } #parameters-for-project--function + table tr :nth-child(1) { width: 20%; } #parameters-for-project--function + table tr :nth-child(2) { width: 60%; padding-right: 20px } #parameters-for-project--function + table tr :nth-child(3) { width: 20%; } </style> <h2 id="step-three-setting-up-your-api-gateway-on-aws">Step Three: Setting up your API Gateway on AWS</h2> <h3 id="api-creation">API Creation</h3> <p>Last step until we have a functioning API! Log into your AWS account and go to the API Gateway service (Make sure you’re in the same region as Apex is configured with). Hit get started and you will be greeted with an easy new API creation form fill it out with your information like so <img ref="AWS API Create Configuration" src="/assets/img/posts/aws-api-with-apex/aws-api-create-1.png"> <br></p> <h3 id="adding-methods-and-endpoints-to-our-apis">Adding methods and endpoints to our APIS</h3> <p>This next part is pretty straight forward if you know REST APIs. We’ve been dumped onto another API configuration form. This form allows us to add and remove end points and methods to connect to them as well as deploying this API to production or any other stage you choose.</p> <p>First thing’s first let’s add an end point. In the actions drop down select create resource and fill in the resource’s name with something like “hello”, “apiexample”, etc.</p> <p>Now select your newly created resource and in the actions drop down select create method and choose how you want to connect to it. I’m doing GET because well it makes sense and it’s easy. This is the part where we choose what happens when we hit the endpoint. Right now we are going to select Lambda Function, our lambda region and the lambda function we want, like so. <img ref="AWS API Create Endpoint" src="/assets/img/posts/aws-api-with-apex/create-endpoint-2.png"></p> <h3 id="deploying-our-api--testing">Deploying our API &amp; Testing</h3> <p>Now we have everything we need to deploy and test. In the actions dropdown select ‘Deploy API’ and create a new deployment stage (I used prod) and a description if you’d like and smash that mother ‘fuckin deploy button.</p> <p>After deployment, AWS redirects you to the stages section. Explore through the newly created API and click on the method you created. AWS hands you a nice little invoke URL. Now if you used GET as your method you can just click on it and see the fruits of your label. If you didn’t use GET you can just use Postman or Fiddler to request it.</p> <h3 id="postman-example">Postman Example</h3> <p><img ref="AWS API Create Endpoint" src="/assets/img/posts/aws-api-with-apex/postman-example-3.png"></p> <h2 id="outro">Outro</h2> <p>It’s been a ride, friends, we have a working and maintainable bare bones API project with Apex using any language(s) that you choose. See y’all in the next post or maybe on my github <a href="https://github.com/leobeosab">@leobeosab</a>, twitter <a href="https://twitter.com/ride_faster">@ride_faster</a> or on the street <a href="https://www.google.com/maps/place/Grand+Rapids,+MI/@42.9563371,-85.7301284,12z/data=!3m1!4b1!4m5!3m4!1s0x88185460bb502815:0xa593aacb1bd3a8d0!8m2!3d42.9633599!4d-85.6680863">@Grand Rapids, Mi</a></p> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="/tags/#AWS" title="Pages tagged AWS" class="tag"><span class="term">AWS</span></a><a href="/tags/#Python" title="Pages tagged Python" class="tag"><span class="term">Python</span></a><a href="/tags/#Node.js" title="Pages tagged Node.js" class="tag"><span class="term">Node.js</span></a><a href="/tags/#Lambda" title="Pages tagged Lambda" class="tag"><span class="term">Lambda</span></a><a href="/tags/#Apex" title="Pages tagged Apex" class="tag"><span class="term">Apex</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=/python-with-apex/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=/python-with-apex/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=/python-with-apex/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> <section id="disqus_thread" class="animated fadeInUp"></section><!-- /#disqus_thread --> </header> <!-- JS --> <script src="/assets/js/jquery-1.12.0.min.js"></script> <script src="/assets/js/jquery.dlmenu.min.js"></script> <script src="/assets/js/jquery.goup.min.js"></script> <script src="/assets/js/jquery.magnific-popup.min.js"></script> <script src="/assets/js/jquery.fitvid.min.js"></script> <script src="/assets/js/scripts.js"></script> <script type="text/javascript"> var disqus_shortname = 'ryanwise-me'; (function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); })(); (function () { var s = document.createElement('script'); s.async = true; s.type = 'text/javascript'; s.src = '//' + disqus_shortname + '.disqus.com/count.js'; (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s); }()); </script> <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
